icon: https://apps.okteto.com/movies/icon.png

build:
  rent:
    context: rentals/rent
  worker:
    context: rentals/worker

deploy:
  divert:
    namespace: ${OKTETO_SHARED_NAMESPACE}
  commands:
  - name: Deploy Rent
    command: helm upgrade --install rentals rentals/chart --set api.image=${OKTETO_BUILD_RENT_IMAGE} --set worker.image=${OKTETO_BUILD_WORKER_IMAGE}

dev:
  rent:
    command: mvn spring-boot:run
    workdir: /app
    sync:
      - rentals/rent:/app
    volumes:
      - /root/.m2
    forward:
      - 5005:5005
      - 5432:postgresql:5432

  worker: 
    image: okteto/golang:1.24
    workdir: /usr/src/app
    command: bash
    securityContext:
      capabilities:
        add:
        - SYS_PTRACE
    sync:
      - rentals/worker:/usr/src/app
    forward:
      - 2345:2345